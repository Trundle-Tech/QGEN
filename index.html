<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSHA Focus Four: Adaptive Assessment</title>
    <style>
        :root {
            --primary: #d32f2f;
            --secondary: #333;
            --light: #f9f9f9;
            --border: #ddd;
            --success: #2e7d32;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; color: #333; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        
        /* Image Debugging Styles */
        .question-image-container { text-align: center; margin-bottom: 20px; background: #eee; padding: 10px; border-radius: 8px; min-height: 100px; }
        .question-image { max-width: 100%; max-height: 350px; border-radius: 4px; display: inline-block; }
        
        /* If image is broken, these styles apply to the alt text */
        .question-image[alt] { font-weight: bold; color: red; }

        .option-btn { background: var(--light); border: 2px solid var(--border); padding: 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; }
        .option-btn:hover { border-color: var(--primary); }
        .option-btn.selected { border-color: var(--primary); background: #ffebee; font-weight: bold; }
        .btn { background: var(--primary); color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-top: 10px; width: 100%; }
        .btn:disabled { background: #ccc; }
        .view { display: none; }
        .view.active { display: block; }
    </style>
</head>
<body>

<div class="container">
    <div id="view-intro" class="view active">
        <h1>OSHA Focus Four Hazards</h1>
        <p>Adaptive Assessment: You will be tested on Fall, Struck-By, Caught-In, and Electrical hazards.</p>
        <button class="btn" onclick="app.startQuiz()">Start Quiz</button>
    </div>

    <div id="view-quiz" class="view">
        <h3 id="progress-text">Question 1</h3>
        <div id="question-container"></div>
        <button class="btn" id="submit-btn" onclick="app.submitAnswer()" disabled>Submit Answer</button>
    </div>

    <div id="view-review" class="view">
        <h2>Review Required</h2>
        <p id="review-subtext"></p>
        <div id="review-list"></div>
        <button class="btn" onclick="app.retakeMissed()">Retake Missed Questions</button>
    </div>

    <div id="view-victory" class="view">
        <h2 style="color: var(--success); text-align: center;">üèÜ Course Complete!</h2>
        <p style="text-align: center;">You have mastered all 16 hazard scenarios.</p>
        <button class="btn" onclick="location.reload()">Restart</button>
    </div>
</div>

<script>
const quizData = [
  { id: 1, topic: "Falls", question: "At what height is fall protection generally required in construction?", img: "138070.jpg", options: ["2 feet", "4 feet", "6 feet", "8 feet"], correct: 2, review: "Falls of 6 feet or more require protection." },
  { id: 2, topic: "Fall Hazards", question: "Identify the hazard: Is this worker safe?", img: "534220.jpg", options: ["Yes, they look safe", "No, this is a fall hazard"], correct: 1, review: "Unprotected edge > 6ft." },
  { id: 3, topic: "Fall Hazards", question: "Does this ladder setup present a fall hazard?", img: "9512003.jpg", options: ["Yes", "No"], correct: 0, review: "Unsafe ladder use causes falls." },
  { id: 4, topic: "Fall Hazards", question: "Is this scaffold constructed correctly?", img: "8829869.jpg", options: ["Yes", "No, it is a fall hazard"], correct: 1, review: "Improper planking/rails on scaffold." },
  { id: 5, topic: "Fall Hazards", question: "Is fall protection required for this roofing work?", img: "2317640.jpg", options: ["Yes", "No"], correct: 0, review: "Roofing work requires fall protection." },
  { id: 6, topic: "Struck-By", question: "What type of hazard does this suspended load represent?", img: "18576025.jpg", options: ["Caught-In", "Struck-By", "Electrocution"], correct: 1, review: "Struck-by falling/swinging load." },
  { id: 7, topic: "Struck-By", question: "Is there a struck-by hazard in this traffic zone?", img: "8829875.jpg", options: ["Yes", "No"], correct: 0, review: "Vehicle struck-by hazard." },
  { id: 8, topic: "Struck-By", question: "Does this image depict a flying object hazard?", img: "34025501.jpg", options: ["Yes", "No"], correct: 0, review: "Flying debris from tools." },
  { id: 9, topic: "Caught-In/Between", question: "Is this trench safe to enter?", img: "8885116.jpg", options: ["Yes", "No, it is a caught-in hazard"], correct: 1, review: "Trench cave-in hazard." },
  { id: 10, topic: "Caught-In/Between", question: "What is the primary hazard of these unguarded gears?", img: "8817847.jpg", options: ["Struck-By", "Caught-In", "Fall"], correct: 1, review: "Caught-in moving gears." },
  { id: 11, topic: "Caught-In/Between", question: "What is the risk here with the heavy equipment near the wall?", img: "5668922.jpg", options: ["Pinned/Caught-Between", "Electrocution", "Fall"], correct: 0, review: "Pinned between equipment and wall." },
  { id: 12, topic: "Caught-In/Between", question: "Is this rotating part a hazard?", img: "8853525.jpg", options: ["Yes", "No"], correct: 0, review: "Caught-in rotating shaft." },
  { id: 13, topic: "Electrocution", question: "What is the major hazard shown here?", img: "0130754.jpg", options: ["Fall", "Electrocution", "Caught-In"], correct: 1, review: "Overhead power lines." },
  { id: 14, topic: "Electrocution", question: "Is this cord safe to use?", img: "8005368.jpg", options: ["Yes", "No"], correct: 1, review: "Damaged cord insulation." },
  { id: 15, topic: "Electrocution", question: "Is this open panel box a hazard?", img: "7081425.jpg", options: ["Yes", "No"], correct: 0, review: "Exposed live parts." },
  { id: 16, topic: "Electrocution", question: "How does the wet condition affect the electrical hazard here?", img: "7397169.jpg", options: ["Reduces risk", "Increases risk"], correct: 1, review: "Wet conditions increase shock risk." }
];

const app = {
    queue: [], missed: [], idx: 0, sel: null,
    init: function() { this.queue = quizData.map(q => q.id); },
    startQuiz: function() {
        this.idx = 0;
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-quiz').classList.add('active');
        this.loadQ();
    },
    loadQ: function() {
        this.sel = null;
        document.getElementById('submit-btn').disabled = true;
        const data = quizData.find(q => q.id === this.queue[this.idx]);
        document.getElementById('progress-text').innerText = `Question ${this.idx + 1} of ${this.queue.length} (${data.topic})`;
        
        let html = '';
        // DEBUG: Removed 'display:none' on error. Added red border style for debugging.
        if(data.img) {
            html += `<div class="question-image-container">
                <img src="assets/${data.img}" class="question-image" alt="IMAGE NOT FOUND: assets/${data.img}" 
                onerror="this.style.border='5px solid red';">
            </div>`;
        }
        
        data.options.forEach((opt, i) => {
            html += `<div class="option-btn" onclick="app.selOpt(${i}, this)">${opt}</div>`;
        });
        document.getElementById('question-container').innerHTML = html;
    },
    selOpt: function(i, el) {
        this.sel = i;
        document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('submit-btn').disabled = false;
    },
    submitAnswer: function() {
        const data = quizData.find(q => q.id === this.queue[this.idx]);
        if(this.sel !== data.correct) { if(!this.missed.includes(data.id)) this.missed.push(data.id); }
        this.idx++;
        if(this.idx < this.queue.length) this.loadQ();
        else this.finish();
    },
    finish: function() {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        if(this.missed.length === 0) {
            document.getElementById('view-victory').classList.add('active');
        } else {
            this.showReview();
        }
    },
    showReview: function() {
        const list = document.getElementById('review-list');
        list.innerHTML = '';
        document.getElementById('review-subtext').innerText = `You missed ${this.missed.length} questions.`;
        this.missed.forEach(id => {
            const data = quizData.find(q => q.id === id);
            list.innerHTML += `<div style="background:#fff; border:1px solid #ddd; padding:15px; margin-bottom:10px;">
                <strong>${data.question}</strong><br>
                <div style="margin:10px 0; background:#eee; padding:5px; text-align:center;">
                    <img src="assets/${data.img}" style="max-height:150px;" alt="Image: ${data.img}">
                </div>
                <p style="color:#d32f2f;">${data.review}</p>
            </div>`;
        });
        document.getElementById('view-review').classList.add('active');
    },
    retakeMissed: function() {
        this.queue = [...this.missed];
        this.missed = [];
        this.startQuiz();
    }
};
app.init();
</script>
</body>
</html>
